<!doctype html>
<html lang="zh-CN">
<head>
    <!-- 放在 <head> 里 -->
  <script src="https://cdn.staticfile.org/pinyin/2.10.2/pinyin.min.js"></script>
  <meta charset="utf-8">
  <title>天气查询-深色模式注释版</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- 国内 CDN，速度快 -->
  <link href="https://cdn.staticfile.org/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.staticfile.org/bootstrap-icons/1.11.0/font/bootstrap-icons.css">

  <style>
    /* ========== 1. 定义两套 CSS 变量 ========== */
    :root{
      --bg-light: linear-gradient(135deg,#89f7fe 0%, #66a6ff 100%);
      --bg-dark:  linear-gradient(135deg,#0f2027 0%, #203a43 100%);
      --card-bg: #ffffff;
      --text-color: #00000098;
      --input-bg: #ffffff;
      --input-color: #212529;
      --alert-bg: #f8f9fa;
      --alert-color: #212529;
    }
    /* ========== 2. 深色模式变量覆盖 ========== */
    body.dark{
      --card-bg: hsl(0, 0%, 0%);
      --text-color: #0080ff;
      --input-bg: #6495ff;
      --input-color: #f8f9fa;
      --alert-bg: #927b7b;
      --alert-color: #f8f9fa;
    }

    /* ========== 3. 全局背景过渡动画 ========== */
    body{
      background: var(--bg-light);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-color);
      transition: background .3s, color .3s;
    }
    body.dark{background: var(--bg-dark);}


    /* ========== 4. 卡片样式 ========== */
    .card{
      background: var(--card-bg);
      border: none;
      border-radius: 1.5rem;
      box-shadow: 0 1rem 3rem rgba(0,0,0,.25);
      max-width: 480px;
    }

    /* ========== 5. 强制改写 Bootstrap 默认色 ========== */
    body.dark .form-control{
      background-color: var(--input-bg);
      color: var(--input-color);
      border-color: #485057;
    }
    body.dark .alert-light{
      background-color: var(--alert-bg);
      color: var(--alert-color);
      border-color: #495057;
    }

    /* ========== 6. 图标大小 ========== */
    .weather-icon{font-size: 4rem;}
    .temp{font-size: 3.5rem; font-weight: 700;}
  </style>
</head>

<body>
  <!-- ========== 7. 深色切换按钮 ========== -->
  <div class="position-absolute top-0 end-0 m-3">
    <button class="btn btn-sm btn-outline-light" onclick="toggleDark()" title="深色/浅色">
      <i class="bi bi-moon-fill"></i>
    </button>
  </div>

  <!-- ========== 8. 主体卡片 ========== -->
  <div class="container">
    <div class="card p-5">
      <h3 class="mb-4 text-center">
        <i class="bi bi-cloud-sun text-primary"></i> 天气查询
      </h3>

      <!-- 输入区 -->
    
      <div class="input-group input-group-lg mb-4">
        <input id="cityInput" type="text" class="form-control" placeholder="请输入城市拼音（如 Beijing）">
        <button id="queryBtn" class="btn btn-primary" onclick="getWeather()">查询</button>
      </div>

      <!-- 加载动画 -->
      <div id="loading" class="text-center d-none">
        <div class="spinner-border text-primary"></div>
        <div class="mt-2">正在获取天气…</div>
      </div>

      <!-- 结果区 -->
      <div id="weatherBox" class="d-none">
        <div class="text-center">
          <div class="weather-icon" id="icon"></div>
          <div class="temp" id="temp"></div>
          <div class="text-muted" id="desc"></div>
          <div class="mt-3">
            <small>体感 <span id="feels"></span> ℃　湿度 <span id="humidity"></span>%</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ========== 9. 深色模式切换 + 本地记忆 ========== */
    function toggleDark(){
      document.body.classList.toggle('dark');
      localStorage.setItem('dark', document.body.classList.contains('dark'));
    }
    // 页面加载时读取记忆
    if (localStorage.getItem('dark') === 'true') document.body.classList.add('dark');

    /* ========== 10. 查询天气 ========== */
    async function getWeather(){
      const city = document.getElementById('cityInput').value.trim();
      if (!city) { alert('请输入城市名'); return; }

      // 加载态
      document.getElementById('loading').classList.remove('d-none');
      document.getElementById('weatherBox').classList.add('d-none');
      document.getElementById('queryBtn').disabled = true;

      const TOKEN = '3f7da0595622cb4afa6123d4f136058e'; // ← 换成你的 OpenWeatherMap Token
      const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${TOKEN}&units=metric&lang=zh_cn`;

      try{
        const res = await fetch(url).then(r => r.json());
        if (res.cod === '404') { alert('城市名有误或无数据'); return; }

        const { weather, main } = res;
        // 图标映射
        const iconMap = {
          '01d':'bi-brightness-high','02d':'bi-cloud-sun','03d':'bi-cloud',
          '04d':'bi-cloud-fill','09d':'bi-cloud-rain','10d':'bi-cloud-drizzle',
          '11d':'bi-lightning','13d':'bi-snow','50d':'bi-cloud-fog'
        };
        document.getElementById('icon').className = 'weather-icon bi ' + (iconMap[weather[0].icon] || 'bi-cloud');
        document.getElementById('temp').textContent = Math.round(main.temp) + ' °C';
        document.getElementById('desc').textContent = weather[0].description;
        document.getElementById('feels').textContent = Math.round(main.feels_like);
        document.getElementById('humidity').textContent = main.humidity;

        document.getElementById('weatherBox').classList.remove('d-none');
      }catch(e){
        alert('网络错误，请检查网络或 Token');
        console.error(e);
      }finally{
        document.getElementById('loading').classList.add('d-none');
        document.getElementById('queryBtn').disabled = false;
      }
    }
  </script>
</body>
</html>